<nav class="bg-gray-300 px-2 py-2 shadow">
  <div class="flex justify-between items-center">
    <div class="breadcrumbs flex items-center">
      <div class="text-lg">
        {{connectedUser.name}}
      </div>
      <svg class="fill-current w-3 h-3 mx-3" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512">
        <path
          d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z" />
      </svg>
      <div class="text-lg underline">
        Paramètres
      </div>
    </div>
    <div class="icons-container flex">
      <img class="w-8 h-8 cursor-pointer mr-2" src="assets/images/bt_add.png" alt="Add" (click)="onAddNewAddress()">
      <!-- <img class="w-8 h-8 cursor-pointer" src="assets/images/bt_delete.png" alt="Delete"> -->
    </div>
  </div>
</nav>
<div class="flex w-full" style="height: 95%;">
  <div class="sidebar w-2/12 bg-gray-700 flex flex-col justify-start items-center">
    <div [ngClass]="selectedMode === 1 ? 'bg-green-500' : 'bg-transparent hover:bg-gray-800'"
      class="text-base xl:text-lg text-white flex justify-center items-center py-3 px-3 mt-10 w-full cursor-pointer"
      (click)="onSelectMode(1)">
      <div>Saisie adresses entrées</div>
    </div>
    <div [ngClass]="selectedMode === 2 ? 'bg-red-500' : 'bg-transparent hover:bg-gray-800'"
      class="text-base xl:text-lg text-white flex justify-center items-center py-3 px-3 w-full cursor-pointer"
      (click)="onSelectMode(2)">
      <div>Saisie adresses sorties</div>
    </div>
    <div *ngIf="logedinUser.isAdmin" class="bg-gray-500 h-1 my-4 rounded w-40">
    </div>
    <div *ngIf="logedinUser.isAdmin"
      [ngClass]="selectedMode === 3 ? 'bg-green-500' : 'bg-transparent hover:bg-gray-800'"
      class="text-base xl:text-lg text-white flex justify-center items-center py-3 px-3 mt-4 w-full cursor-pointer"
      (click)="onSelectMode(3)">
      <div>Consultation categories entrées</div>
    </div>
    <div *ngIf="logedinUser.isAdmin" [ngClass]="selectedMode === 4 ? 'bg-red-500' : 'bg-transparent hover:bg-gray-800'"
      class="text-base xl:text-lg text-white flex justify-center items-center py-3 px-3 w-full cursor-pointer"
      (click)="onSelectMode(4)">
      <div>Consultation categories sorties</div>
    </div>
  </div>
  <div class="main-content w-10/12">
    <div class="flex flex-col pt-8 px-2">
      <div class="flex justify-between items-center py-2 px-10">
        <div class="border-b border-b-2 hover:border-gray-500 flex items-center ml-2 w-3/12">
          <input [(ngModel)]="searchText"
            class="appearance-none bg-transparent border-none w-full mr-3 py-1 px-2 leading-tight focus:outline-none placeholder-gray-500 text-gray-600"
            type="text" placeholder="Recherche" aria-label="Search">
        </div>
        <div class="text-2xl">
          {{addressesCount}}
        </div>
      </div>
      <div class="table-container mt-3">
        <ejs-grid #grid [dataSource]="(addresses$ | async) | addressSearch:searchText" [allowSorting]='true'
          [allowFiltering]='true' [enableVirtualization]='true' [locale]="'fr-CH'" height='750'
          (rowDataBound)='rowDataBound($event)' [selectionSettings]='selectionOptions'>
          <e-columns>
            <e-column type='checkbox' [allowFiltering]='false' [allowSorting]='false' width='60'></e-column>
            <e-column headerText='Adresse'>
              <ng-template #template let-address>
                <div (click)="onRowClick(address)">
                  <span id="Emptext">{{address.name}}</span>
                </div>
              </ng-template>
            </e-column>
            <e-column headerText='Catégorie'>
              <ng-template #template let-address>
                <div (click)="onRowClick(address)">
                  <span>{{address.category.name}}</span>
                </div>
              </ng-template>
            </e-column>
          </e-columns>
        </ejs-grid>
      </div>
    </div>
  </div>
</div>
<div [class.opacity-100]="showEditModal" [class.pointer-events-auto]="showEditModal"
  class="z-20 opacity-0 pointer-events-none modal absolute w-full h-full top-0 left-0 flex items-center justify-center">
  <div class="modal-overlay absolute w-full h-full bg-black opacity-25 top-0 left-0 cursor-pointer"></div>
  <div *ngIf="selectedEditAddress" [ngClass]="selectedMode === -1 ? 'border-green-500' : 'border-red-500'"
    class="absolute bg-white rounded-lg shadow-lg flex flex-col items-center justify-start p-5 border-2">
    <div class="flex flex-col">
      <div class="text-gray-600">Adresse</div>
      <div class="border-b border-b-2 hover:border-gray-500 flex items-center w-80">
        <input [(ngModel)]="selectedEditAddress.name"
          class="appearance-none bg-transparent border-none w-full mr-3 py-1 leading-tight focus:outline-none placeholder-gray-500"
          type="text" placeholder="" aria-label="Search">
      </div>
    </div>
    <div class="flex flex-col mt-6">
      <div class="text-gray-600">Catégorie</div>
      <ejs-dropdownlist *ngIf="selectedEditAddress.category" class="w-80" id='ddEditCategories'
        [dataSource]='categories$ | async' style="margin-top: 1px;" [fields]="categoryListFields"
        [(value)]="selectedEditAddress.category.id" placeholder="Catégorie">
      </ejs-dropdownlist>
    </div>
    <div *ngIf="editAddressErrors" class="bg-transparent border border-red-600 p-3 rounded-xl mt-12">
      <span class="text-sm text-red-600">Le nom de l'adresse ne peut pas être vide</span>
    </div>
    <div *ngIf="!deleteOldAddressConfirm" class="flex w-full justify-center items-center mt-5">
      <button class="hover:bg-green-200 focus:outline-none hover:shadow-lg p-2 rounded-full shadow text-whitew"
        (click)="onSaveEditAddress()">
        <img class="w-10 h-auto cursor-pointer" src="assets/images/save.png" alt="Sorties">
      </button>
      <button *ngIf="canAddressesBeDeleted()"
        class="hover:bg-red-200 focus:outline-none hover:shadow-lg p-2 rounded-full shadow text-whitew ml-4"
        (click)="onDeleteAddress()">
        <img class="w-10 h-auto cursor-pointer" src="assets/images/bt_delete.png" alt="Sorties">
      </button>
      <button class="hover:bg-gray-200 focus:outline-none hover:shadow-lg p-2 rounded-full shadow text-whitew ml-4"
        (click)="showEditModal = false">
        <img class="w-10 h-auto cursor-pointer" src="assets/images/bt_cancel.png" alt="Sorties">
      </button>
    </div>
    <div *ngIf="deleteOldAddressConfirm"
      class="border border-gray-500 flex flex-col ng-star-inserted py-2 px-6 rounded-lg shadow mt-6">
      <div class="text-xl">
        Êtes-vous sûr ?
      </div>
      <div class="flex justify-center items-center mt-2">
        <div
          class="bg-red-500 border-gray-600 cursor-pointer flex items-center justify-center py-1 rounded shadow text-white w-12"
          (click)="onDeleteConfirmed()">
          Oui
        </div>
        <div
          class="bg-gray-600 border-gray-600 cursor-pointer flex items-center justify-center ml-3 py-1 rounded shadow text-white w-12"
          (click)="deleteOldAddressConfirm = false">
          No
        </div>
      </div>
    </div>
  </div>
</div>
<div [class.opacity-100]="showAddModal" [class.pointer-events-auto]="showAddModal"
  class="z-20 opacity-0 pointer-events-none modal absolute w-full h-full top-0 left-0 flex items-center justify-center">
  <div class="modal-overlay absolute w-full h-full bg-black opacity-25 top-0 left-0 cursor-pointer"></div>
  <div *ngIf="newAddress" [ngClass]="addAddressInout === -1 ? 'border-green-500' : 'border-red-500'"
    class="absolute bg-white rounded-lg shadow-lg flex flex-col items-center justify-start p-5 border-2">
    <div class="flex flex-col">
      <div class="text-gray-600">Adresse</div>
      <div class="border-b border-b-2 hover:border-gray-500 flex items-center w-80">
        <input [(ngModel)]="newAddress.name"
          class="appearance-none bg-transparent border-none w-full mr-3 py-1 leading-tight focus:outline-none placeholder-gray-500"
          type="text" placeholder="" aria-label="Search">
      </div>
    </div>
    <div class="flex flex-col mt-6">
      <div class="text-gray-600">Catégorie</div>
      <ejs-dropdownlist *ngIf="newAddress.category" class="w-80" id='ddAddCategories' [dataSource]='categories$ | async'
        style="margin-top: 1px;" [fields]="categoryListFields" [(value)]="newAddress.category.id"
        placeholder="Catégorie">
      </ejs-dropdownlist>
    </div>
    <div *ngIf="addAddressErrors" class="bg-transparent border border-red-600 p-3 rounded-xl mt-12">
      <span class="text-sm text-red-600">Le nom de l'adresse ne peut pas être vide</span>
    </div>
    <div class="flex w-full justify-center items-center mt-5">
      <button class="hover:bg-green-200 focus:outline-none hover:shadow-lg p-2 rounded-full shadow text-whitew"
        (click)="onSaveAddAddress()">
        <img class="w-10 h-auto cursor-pointer" src="assets/images/save.png" alt="Sorties">
      </button>
      <button class="hover:bg-gray-200 focus:outline-none hover:shadow-lg p-2 rounded-full shadow text-whitew ml-4"
        (click)="showAddModal = false">
        <img class="w-10 h-auto cursor-pointer" src="assets/images/bt_cancel.png" alt="Sorties">
      </button>
    </div>
  </div>
</div>
